# Регистрация через номер телефона - Руководство

## Нужен ли домен?

**НЕТ, домен НЕ обязателен** для базовой регистрации через номер телефона.

Домен может понадобиться только для:
- **Верифицированного Sender ID** (альфа-отправитель вместо номера) - опционально
- **Брендированных SMS** - опционально

Для обычной отправки SMS с кодом подтверждения домен **НЕ требуется**.

---

## Варианты SMS-сервисов

### 1. **Twilio** (Рекомендуется) ⭐
- ✅ Бесплатный пробный период ($15.50 кредитов)
- ✅ Простая интеграция
- ✅ Поддержка международных номеров
- ✅ Хорошая документация
- ❌ Платный после пробного периода (~$0.0075 за SMS)

**Регистрация:** https://www.twilio.com/try-twilio

### 2. **AWS SNS** (Amazon Simple Notification Service)
- ✅ Интеграция с AWS экосистемой
- ✅ Низкие цены (~$0.00645 за SMS)
- ✅ Масштабируемость
- ❌ Требует AWS аккаунт
- ❌ Более сложная настройка

**Регистрация:** https://aws.amazon.com/sns/

### 3. **MessageBird**
- ✅ Простая интеграция
- ✅ Хорошие цены
- ❌ Меньше бесплатных кредитов

**Регистрация:** https://www.messagebird.com/

### 4. **Vonage** (ранее Nexmo)
- ✅ Хорошая документация
- ✅ Надежность
- ❌ Меньше бесплатных кредитов

**Регистрация:** https://www.vonage.com/

---

## Быстрый старт с Twilio (Рекомендуется)

### Шаг 1: Регистрация в Twilio

1. Перейдите на https://www.twilio.com/try-twilio
2. Зарегистрируйтесь (можно использовать email)
3. Подтвердите номер телефона
4. Получите:
   - **Account SID** (начинается с `AC...`)
   - **Auth Token** (секретный ключ)
   - **Trial Phone Number** (бесплатный номер для тестирования)

### Шаг 2: Настройка переменных окружения на Render

Добавьте в Environment Variables:
```
TWILIO_ACCOUNT_SID=ACxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
TWILIO_AUTH_TOKEN=your_auth_token_here
TWILIO_PHONE_NUMBER=+1234567890  # Ваш Twilio номер
```

### Шаг 3: Установка пакета

```bash
npm install twilio
```

### Шаг 4: Использование

Код уже реализован в `auth/auth.js` и `auth/routes.js`. Просто используйте API:

**Отправка кода:**
```
POST /auth/phone/register
Body: { phone: "+79991234567", password: "password123", username: "user" }
```

**Подтверждение кода:**
```
POST /auth/phone/verify
Body: { phone: "+79991234567", code: "123456" }
```

---

## Ограничения бесплатного плана Twilio

- ✅ Можно отправлять SMS только на **верифицированные номера** (в пробном периоде)
- ✅ Бесплатный номер для тестирования
- ❌ Нельзя отправлять на любые номера без верификации (в пробном периоде)

**Решение:** Верифицируйте номера в Twilio Console или перейдите на платный план.

---

## Альтернатива: Использование бесплатных SMS API

### TextBelt (Очень ограниченный)
- ❌ Только для США
- ❌ Очень ограниченный функционал

### SMS.ru (Россия)
- ✅ Работает в России
- ✅ Есть бесплатный план (ограниченный)
- ❌ Только для российских номеров

---

## Рекомендация

**Для начала используйте Twilio:**
1. Простая настройка
2. Бесплатный пробный период
3. Хорошая документация
4. Работает везде

**Домен НЕ нужен** - просто добавьте переменные окружения и начните отправлять SMS!

---

## API Endpoints

### 1. Регистрация через телефон (отправка кода)

**POST** `/auth/phone/register`

**Body:**
```json
{
  "phone": "+79991234567",
  "password": "password123",
  "username": "user" // опционально
}
```

**Response:**
```json
{
  "success": true,
  "message": "Код подтверждения отправлен на ваш номер телефона",
  "development": {
    "verificationCode": "123456",
    "message": "SMS отправлено. Проверьте телефон или используйте код ниже.",
    "smsSent": true,
    "smsError": null
  }
}
```

### 2. Подтверждение телефона (создание пользователя)

**POST** `/auth/phone/verify`

**Body:**
```json
{
  "phone": "+79991234567",
  "code": "123456"
}
```

**Response:**
```json
{
  "success": true,
  "message": "Телефон подтвержден. Регистрация завершена!",
  "token": "jwt_token_here",
  "user": {
    "id": "user_id",
    "phone": "+79991234567",
    "username": "user",
    "twoFactorEnabled": false
  }
}
```

### 3. Вход через телефон

**POST** `/auth/phone/login`

**Body:**
```json
{
  "phone": "+79991234567",
  "password": "password123",
  "twoFactorToken": "123456" // опционально, если включен 2FA
}
```

**Response:**
```json
{
  "success": true,
  "token": "jwt_token_here",
  "user": {
    "id": "user_id",
    "phone": "+79991234567",
    "username": "user",
    "twoFactorEnabled": false
  }
}
```

---

## Формат номера телефона

Номер телефона должен быть в международном формате с кодом страны:
- ✅ `+79991234567` (Россия)
- ✅ `+1234567890` (США)
- ✅ `+447911123456` (Великобритания)

Номер автоматически нормализуется (убираются пробелы, дефисы, скобки).

---

## Готово!

Теперь у вас есть полная система регистрации через номер телефона. **Домен не требуется!**

